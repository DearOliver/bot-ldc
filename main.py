#Import des librairies

import asyncio
import math
import json
import ffmpeg
import discord
import youtube_dl
from fonctions import *
from datetime import datetime, timedelta
from discord.utils import get
from discord.ext import commands, tasks

#Instanciation du bot

intents = discord.Intents.default()
intents.members = True

steve = commands.Bot(command_prefix = "ldc ", description = "Steve aux commandes de la LDC !", intents=intents)
roles = []
liste_commandes = []

#Variable

musics = {}
ytdl = youtube_dl.YoutubeDL()

#Classes

class Video :
    def __init__(self, link) :
        video = ytdl.extract_info(link, download = False)
        video_format = video["formats"][0]
        self.url = video["webpage_url"]
        self.stream_url = video_format["url"]

#Fonctions

def is_music_channel(ctx) :
    return ctx.message.channel.id == 785436963490496522

def is_cmd_channel(ctx) :
    return ctx.message.channel.id == 785436944988766228

def next_(client, queue) :
    if len(queue) > 0 :
        new_song = queue[0]
        del queue[0]
        play_(client, queue, new_song)
    else :
        asyncio.run_coroutine_threadsafe(client.disconnect(), steve.loop)

def play_(client, queue, song) :

    source = discord.PCMVolumeTransformer(discord.FFmpegPCMAudio(source = song.stream_url, before_options = "-reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 5"), volume = 0.5)

    client.play(source, after = next)   

    print("Song playing")

def reset_contrat(week_index, date_jour) :
    f = open('ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    week_resets = ldc_api['calendrier'][week_index]['resets']

    if week_resets['contrats'] == 'True' :
        return
    else :
        for contrat in ldc_api['contrats'] :
            date_debut = datetime.strptime(contrat['date_debut'], '%A %d/%m/%Y')
            date_fin = date_debut + timedelta(weeks = int(contrat['nombre_de_semaine']))

            if date_jour.strftime('%A %d/%m/%Y') == date_fin.strftime('%A %d/%m/%Y') :

                f = open('./ldc_api.json', 'r')
                ldc_api = json.load(f)
                f.close()

                contrat_index = ldc_api['contrats'].index(contrat)
                valeur_contrat = contrat['valeur']
                contrat_id = contrat['contrat_id']
                joueur_id = contrat['joueur_id']
                equipe_id = contrat['equipe_id']

                #Annulation du contrat

                api_remove_contrat(str(contrat_id))
                api_remove_joueur_from_team(str(joueur_id), str(equipe_id), valeur_contrat)

                #Suppression des r√¥les et changement de nickname

                guild = get(steve.guilds, id = 784476911924674581)
                equipe = guild.get_role(int(equipe_id))
                role_inscrit = get(guild.roles, name="Inscrit")
                joueur = get(guild.members, id = int(joueur_id))

                asyncio.run_coroutine_threadsafe(joueur.add_roles(role_inscrit), steve.loop)
                asyncio.run_coroutine_threadsafe(joueur.remove_roles(equipe), steve.loop)

                if joueur.id != 330789745607049216 :
                    asyncio.run_coroutine_threadsafe(joueur.edit(nick = f'{joueur.name}'), steve.loop)

                equipe_trouvee = False

                for equipe_ in ldc_api['equipes']['equipes_ligue'] :
                    if equipe_['equipe_id'] == str(equipe.id) :
                        equipe_trouvee = True
                        index_equipe = ldc_api['equipes']['equipes_ligue'].index(equipe_)

                equipe_choisie = ldc_api['equipes']['equipes_ligue'][index_equipe]
                equipe_name = equipe_choisie['nom']
                equipe_logo = equipe_choisie['logo']
                equipe_color = equipe_choisie['color']

                file = discord.File(f"./Sources/Images/Logos/{equipe_logo}")
                embed = discord.Embed(title = "‚ùå __***Fin de contrat***__ ‚ùå", color=int(equipe_color, base = 16))
                embed.set_thumbnail(url = f"attachment://{equipe_logo}")
                embed.add_field(name = f"{joueur.name}", value = f"ach√®ve contrat avec *{equipe_name}* !", inline=False)

                asyncio.run_coroutine_threadsafe(joueur.send(f"‚ùå Vous ach√®vez votre contrat avec **{equipe.name}** ‚ùå!"), steve.loop)
                asyncio.run_coroutine_threadsafe(steve.get_channel(784476911924674584).send(file = file, embed = embed), steve.loop)

        f = open('./ldc_api.json', 'r')
        ldc_api = json.load(f)
        f.close()

        ldc_api['calendrier'][week_index]['resets']['contrats'] = 'True'

        f = open('ldc_api.json', 'w')
        json.dump(ldc_api, f)
        f.close()

def avertir_matchs(week_index) :
    f = open('ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    week_resets = ldc_api['calendrier'][week_index]['resets']
    week = ldc_api['calendrier'][week_index]

    if week_resets['matchs'] == 'True' :
        return
    else :
        file = discord.File(f"./Sources/Images/Logos/cup_logo4.png")
        embed = discord.Embed(title = "üì£ __***Annonce de la Semaine " + str(week['week']) + "***__ üì£", color=0xff7b00)
        embed.set_thumbnail(url = f"attachment://cup_logo4.png")
        embed.add_field(name = "__Map Pool__", value = week['map_pool'][0] + "\n" + week['map_pool'][1] + "\n" + week['map_pool'][2] + "\n" + week['map_pool'][3], inline=False)

        numero_match = 1

        for match in ldc_api['calendrier'][week_index]['matchs']['a_prevoir'] :
            for equipe in ldc_api['equipes']['equipes_ligue'] :
                if str(equipe['equipe_id']) == str(match['id_A']) : 
                    equipeA_index = ldc_api['equipes']['equipes_ligue'].index(equipe)
                if str(equipe['equipe_id']) == str(match['id_B']) :
                    equipeB_index = ldc_api['equipes']['equipes_ligue'].index(equipe)
            equipeA = ldc_api['equipes']['equipes_ligue'][equipeA_index]
            equipeB = ldc_api['equipes']['equipes_ligue'][equipeB_index]

            if equipeA['manager_id'] != "0" :
                managerA = get(steve.get_all_members(), id = int(equipeA['manager_id']))
            else :
                print("Manager non-attribu√©")
                return
            if equipeB['manager_id'] != "0" :
                managerB = get(steve.get_all_members(), id = int(equipeB['manager_id']))
            else :
                print("Manager non-attribu√©")
                return

            file_A = discord.File("./Sources/Images/Logos/" + equipeA['logo'])
            file_B = discord.File("./Sources/Images/Logos/" + equipeB['logo'])
            embed_A = discord.Embed(title = "üì£ __***Annonce de la Semaine " + str(week['week']) + "***__ üì£", color=int(equipeA['color'], base = 16))
            embed_B = discord.Embed(title = "üì£ __***Annonce de la Semaine " + str(week['week']) + "***__ üì£", color=int(equipeB['color'], base = 16))
            embed_A.set_thumbnail(url = "attachment://" + equipeA['logo'])
            embed_B.set_thumbnail(url = "attachment://" + equipeB['logo'])
            embed_A.add_field(name = "__Map Pool__", value = week['map_pool'][0] + "\n" + week['map_pool'][1] + "\n" + week['map_pool'][2] + "\n" + week['map_pool'][3], inline=False)
            embed_B.add_field(name = "__Map Pool__", value = week['map_pool'][0] + "\n" + week['map_pool'][1] + "\n" + week['map_pool'][2] + "\n" + week['map_pool'][3], inline=False)
            embed_A.add_field(name = "__Adversaire__", value = equipeB['nom'], inline=False)
            embed_B.add_field(name = "__Adversaire__", value = equipeA['nom'], inline=False)
            embed_A.add_field(name = "__Manager__", value = managerA.name, inline=True)
            embed_B.add_field(name = "__Manager__", value = managerB.name, inline=True)

            asyncio.run_coroutine_threadsafe(managerA.send(file = file_A, embed = embed_A), steve.loop)
            asyncio.run_coroutine_threadsafe(managerB.send(file = file_B, embed = embed_B), steve.loop)

            embed.add_field(name = "__Match " + str(numero_match) + "__", value = equipeA['nom'] + " VS " + equipeB['nom'], inline = False)

            numero_match += 1
        asyncio.run_coroutine_threadsafe(steve.get_channel(784476911924674584).send(file = file, embed = embed), steve.loop)

        f = open('./ldc_api.json', 'r')
        ldc_api = json.load(f)
        f.close()

        ldc_api['calendrier'][week_index]['resets']['matchs'] = 'True'

        f = open('ldc_api.json', 'w')
        json.dump(ldc_api, f)
        f.close()

#Events

@tasks.loop(minutes = 1)
async def check_date():
    date_debut = datetime.now()
    jour = datetime.now().strftime('%A')
    heure = datetime.now().strftime('%H:%M')

    f = open('ldc_api.json',)
    ldc_api = json.load(f)
    f.close()

    #Check de la semaine

    if jour == 'Tuesday' :
        date_debut -= timedelta(days=1)
    elif jour == 'Wednesday' :
        date_debut -= timedelta(days=2)
    elif jour == 'Thursday' :
        date_debut -= timedelta(days=3)
    elif jour == 'Friday' :
        date_debut -= timedelta(days=4)
    elif jour == 'Saturday' :
        date_debut -= timedelta(days=5)
    elif jour == 'Sunday' :
        date_debut -= timedelta(days=6)

    week_found = False

    for week in ldc_api['calendrier'] :
        if week['date_debut'] == date_debut.strftime('%A %d/%m/%Y') :
            week_found = True
            week_index = ldc_api['calendrier'].index(week)
    
    if week_found == False :
        return
    
    if jour == 'Tuesday' and heure == '23:28' :
        #reset_contrat(week_index, date_debut)
        avertir_matchs(week_index)

    for match in ldc_api['calendrier'][week_index]['matchs']['prevus'] :
        
        match_jour = (datetime.strptime(match['date'], '%A %d/%m/%Y %H:%M')).strftime('%A')
        match_heure = datetime.strptime(match['date'], '%A %d/%m/%Y %H:%M')
        match_heure_minus = (match_heure - timedelta(hours=1)).strftime('%H:%M')

        if jour == match_jour and heure == match_heure_minus :
            print('1 heure avant le match')

@steve.event
async def on_ready() :
    check_date.start()
    print("Steve op√©rationnel !")

@steve.event
async def on_message(message) :
    if message.author == steve.user :
        return
    await steve.process_commands(message)

@steve.event
async def on_member_join(member) :
    role_nouveau = member.guild.roles[1]
    await member.add_roles(role_nouveau)

@steve.event
async def on_command_error(ctx, error) :

    if isinstance(error, commands.CommandNotFound) :
        await ctx.message.author.send("‚ö†Ô∏è La commande n'existe pas ! ‚ö†Ô∏è")
    elif isinstance(error, commands.MissingRequiredArgument) :
        await ctx.message.author.send("‚ö†Ô∏è Il manque un argument dans ta commande ! ‚ö†Ô∏è")
    elif isinstance(error, commands.MissingRole) :
        await ctx.message.author.send("‚ö†Ô∏è Tu n'as pas les permissions pour lancer cette commande ! ‚ö†Ô∏è")
    elif isinstance(error, commands.CheckFailure) :
        await ctx.message.author.send("‚ö†Ô∏è Vous ne pouvez pas lancer cette commande dans ce channel ! ‚ö†Ô∏è")
    else :
        print(error)
        await ctx.message.author.send("‚ö†Ô∏è ERREUR ! ‚ö†Ô∏è")

#Commandes

@steve.command()
@commands.check(is_cmd_channel)
async def membres(ctx) :
    await ctx.message.delete()
    server = ctx.guild
    await ctx.send(f"Il y a actuellement **{server.member_count} membres** sur le serveur !")

@steve.command()
@commands.check(is_music_channel)
async def next(ctx) :
    client = ctx.guild.voice_client
    next_(client, musics)

@steve.command()
@commands.check(is_music_channel)
async def stop(ctx) :
    client = ctx.guild.voice_client
    await client.disconnect()
    musics[ctx.guild] = []

@steve.command()
@commands.check(is_music_channel)
async def resume(ctx) :
    client = ctx.guild.voice_client
    if client.is_paused() :
        client.resume()

@steve.command()
@commands.check(is_music_channel)
async def pause(ctx) :
    client = ctx.guild.voice_client
    if not client.is_paused() :
        client.pause()

@steve.command()
@commands.check(is_music_channel)
async def skip(ctx) :
    client = ctx.guild.voice_client
    client.stop()

@steve.command()
@commands.has_role('Mod√©rateur')
@commands.check(is_music_channel)
async def play(ctx, url) :

    author = ctx.message.author
    client = ctx.guild.voice_client

    if author.voice :
        channel = ctx.author.voice.channel
    else :
        await author.send("‚ö†Ô∏è Tu n'es pas connect√© √† un channel vocal ! ‚ö†Ô∏è")
        return

    video = Video(url)

    if client and client.channel :

        video = Video(url)
        musics[ctx.guild].append(video)

    else :

        musics[ctx.guild] = []
        client = await channel.connect()
        await ctx.send(f"**Lancement de ** {video.url} par **{author.name}**")

    play_(client, musics[ctx.guild], video)

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur')
async def nettoyer(ctx, nombre : int) :
    await ctx.message.delete()
    author = ctx.message.author

    #V√©rification si l'auteur est mod√©rateur

    #role_moderateur = ctx.guild.roles[6]
    #a_role_moderateur = False

    #for role in author.roles :
    #    if role == role_moderateur :
    #        a_role_moderateur = True

    #if a_role_moderateur == False :
    #    await author.send("‚ö†Ô∏è Tu n'as pas les droits pour effectuer cette commande ! ‚ö†Ô∏è")
    #    return

    messages = await ctx.channel.history(limit = nombre).flatten()

    for message in messages :
        await message.delete()

@steve.command()
@commands.check(is_cmd_channel)
async def inscription(ctx) :
    author = ctx.message.author
    await ctx.message.delete()

    def check_message(message) :
        return message.author == ctx.message.author

    #V√©rification si l'auteur est d√©j√† inscrit

    role_nouveau = ctx.guild.roles[1]
    role_inscrit = ctx.guild.roles[2]

    for role in author.roles :
        if role == role_inscrit :
            await author.send("‚ö†Ô∏è Tu es d√©j√† inscrit ! ‚ö†Ô∏è")
            return
    await author.send("** üèÜ INSCRIPTION LOCKDOWN CUP üèÜ **")
    
    #Demande du pseudo

    pseudo_correct = False

    while pseudo_correct == False :

        await author.send("‚ùì Quel est ton pseudo in-game ? ‚ùì")
        try :
            message_pseudo = await steve.wait_for("message", timeout = 40, check = check_message)

        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return

        pseudo = message_pseudo.content

        if pseudo != "" :
            pseudo_correct = True
        else :
            await author.send("‚ö†Ô∏è Ton pseudo est incorrect ! ‚ö†Ô∏è")

    #Demande du btag

    btag_correct = False

    while btag_correct == False :

        await author.send("‚ùì Quel est ton battletag ? ‚ùì")
        try :
            message_btag = await steve.wait_for("message", timeout = 40, check = check_message)
        
        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return
        
        btag = message_btag.content

        if btag != "" :
            btag_correct = True
        else :
            await author.send("‚ö†Ô∏è Ton battletag est incorrect ! ‚ö†Ô∏è")

    #Demande de la c√¥te actuelle

    cote_actuelle_correcte = False

    while cote_actuelle_correcte == False :

        await author.send("‚ùì Quel est ta c√¥te actuelle **sur ton r√¥le principal** ? ‚ùì")
        try :
            message_cote_actuelle = await steve.wait_for("message", timeout = 40, check = check_message)

        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return

        cote_actuelle = int(message_cote_actuelle.content)

        if cote_actuelle >= 1500 and cote_actuelle <= 4700 :
            cote_actuelle_correcte = True
        else :
            await author.send("‚ö†Ô∏è Ta c√¥te actuelle est incorrecte ! ‚ö†Ô∏è")

    #Demande du peak de c√¥te

    cote_peak_correcte = False

    while cote_peak_correcte == False :

        await author.send("‚ùì Quel est ton pic de carri√®re **tous r√¥les confondus, toutes saisons confondues, tous comptes confondus** ? ‚ùì")
        try :
            message_cote_peak = await steve.wait_for("message", timeout = 40, check = check_message)

        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return
        
        cote_peak = int(message_cote_peak.content)

        if cote_peak >= 1500 and cote_peak <= 4700 :
            if cote_peak >= cote_actuelle :
                cote_peak_correcte = True
            else :
                await author.send("‚ö†Ô∏è Ton pic de carri√®re est inf√©rieur √† ta c√¥te actuelle ! ‚ö†Ô∏è")
        else :
            await author.send("‚ö†Ô∏è Ton pic de carri√®re est incorrect ! ‚ö†Ô∏è")

    #Demande du r√¥le

    message_roles = await author.send("‚ùì Quel est **ton r√¥le principal** ? *(Tank, Dps, Heal ou Flex)* ‚ùì")
    await message_roles.add_reaction("üõ°Ô∏è")
    await message_roles.add_reaction("‚öîÔ∏è")
    await message_roles.add_reaction("üíä")
    await message_roles.add_reaction("‚ôªÔ∏è")

    def check_reaction(reaction, user) :
        return user == ctx.message.author and message_roles.id == reaction.message.id and (str(reaction.emoji) == "üõ°Ô∏è" or str(reaction.emoji) == "‚öîÔ∏è" or str(reaction.emoji) == "üíä" or str(reaction.emoji) == "‚ôªÔ∏è")

    try :
        reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction)

    except :
        await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
        return

    if reaction.emoji == "üõ°Ô∏è" :
        role = 'Tank'
    elif reaction.emoji == "‚öîÔ∏è" :
        role = 'Dps'
    elif reaction.emoji == "üíä" :
        role = 'Heal'
    elif reaction.emoji == "‚ôªÔ∏è" :
        role = 'Flex'

    #Demande des meilleurs picks

    picks_corrects = 0

    while picks_corrects < 3 :

        await author.send("‚ùì Quels sont tes **3 meilleurs picks** (tous r√¥les confondus) ? ‚ùì")
        await author.send("```\npick1,pick2,pick3\n```")
        try :
            message_picks = await steve.wait_for("message", timeout = 40, check = check_message)

        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return

        picks = []
        picks.extend(message_picks.content.split(","))

        for pick in picks :
            if pick != "" :
                picks_corrects += 1
            else :
                await author.send("‚ö†Ô∏è Un de tes picks est incorrect ! ‚ö†Ô∏è")
                picks_corrects = 0

    #Obtention du moment d'inscription

    date_inscription = datetime.now().strftime('%d/%m/%Y %H:%M')

    #Inscription du joueur dans le fichier de donn√©es

    api_push_joueur(pseudo, author.id, str(user), btag, cote_actuelle, cote_peak, calculerValeur(cote_actuelle, cote_peak), role, picks, date_inscription, date_inscription, 0)

    #Attribution du r√¥le

    await author.remove_roles(role_nouveau)
    await author.add_roles(role_inscrit)

    #Confirmation

    await author.send("‚úÖ Vous avez bien √©t√© enregistr√© comme agent libre dans la LockDown Cup ! ‚úÖ\nPensez √† poser votre candidature en CV dans le channel d√©di√© pour augmenter vos chances de vous faire recruter !")

@steve.command()
@commands.check(is_cmd_channel)
async def resignation(ctx, joueurUser : discord.User) :
    author = ctx.message.author
    await ctx.message.delete()

    joueur = ctx.guild.get_member(joueurUser.id)

    #Verification des droits

    a_permissions = False
    is_author = False
    est_nouveau = False

    role_moderateur = ctx.guild.roles[6]
    role_nouveau = ctx.guild.roles[1]

    if joueur == author :
        a_permissions = True
        is_author = True
    for role in author.roles :
        if role == role_moderateur :
            a_permissions = True
        if role == role_nouveau :
            est_nouveau = True

    if est_nouveau == True :
        await author.send("‚ö†Ô∏è Tu n'es pas inscrit √† la LDC ! ‚ö†Ô∏è")
        return
    if a_permissions == False :
        await author.send("‚ö†Ô∏è Tu n'as pas les droits pour lancer cette commande ! ‚ö†Ô∏è")
        return

    #Suppression de la liste des joueurs

    api_remove_joueur(str(joueur))

    #R√©trogradation des r√¥les

    for role in joueur.roles :
        await joueur.remove_roles(role)

    await joueur.add_roles(role_nouveau)

    #Confirmation

    if is_author == True :
        await author.send(f"‚úÖ Vous vous √™tes bien d√©sinscrit(e) ! ‚úÖ")
    else :
        await author.send(f"‚úÖ **{joueur.name}** a bien √©t√© d√©sinscrit(e) ! ‚úÖ")

@steve.command()
@commands.check(is_cmd_channel)
async def modification(ctx) :
    author = ctx.message.author
    await ctx.message.delete()

    def check_message(message) :
        return message.author == ctx.message.author

    #V√©rification si l'auteur est inscrit

    role_nouveau = ctx.guild.roles[1]

    for role in author.roles :
        if role == role_nouveau :
            await author.send("‚ö†Ô∏è Tu n'es pas encore inscrit ! ‚ö†Ô∏è")
            return

    #Chargement des donn√©es depuis l'API

    f = open('ldc_api.json',)
    ldc_api = json.load(f)
    f.close()
    liste_joueurs = ldc_api['joueurs']

    #Obtention du joueur dans l'API

    joueur_trouve = False

    for joueur in ldc_api['joueurs'] :
        if joueur['dtag'] == str(author) :
            joueur_index = ldc_api['joueurs'].index(joueur)
            joueur_trouve = True

    if joueur_trouve == False :
        await author.send("‚ö†Ô∏è Erreur : Vous n'√™tes pas reconnu dans le fichier de donn√©es ! ‚ö†Ô∏è")
        print('ERREUR : Index non-trouv√© 00010 !')
        return

    await author.send("** üèÜ MODIFICATION DES INFORMATIONS PERSONNELLES üèÜ **")

    joueur = liste_joueurs[joueur_index]
    modifications_terminees = False

    while modifications_terminees == False :

        #Demande des infos √† modifier

        choix_valide = False

        while choix_valide == False :

            await author.send(f"```\nVos informations personnelles :\n\n1 - Pseudo : {joueur['pseudo']}\n2 - BattleTag : {joueur['btag']}\n3 - C√¥tes : {joueur['cote_peak']} | {joueur['cote_actuelle']}\n4 - R√¥le : {joueur['role']}\n5 - Picks : {joueur['picks'][0]} | {joueur['picks'][1]} | {joueur['picks'][2]}\n6 - Annuler\n```")
            await author.send("‚ùì Quelles informations souhaitez-vous modifier ? (entrez **le num√©ro de la ligne**) ‚ùì")
            
            try :
                choix_message = await steve.wait_for("message", timeout = 40, check = check_message)

            except :
                await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
                return

            choix = int(choix_message.content)
            if choix <= 6 and choix >= 1 :
                choix_valide = True
            else :
                await author.send("‚ö†Ô∏è Votre choix n'est pas correct ! ‚ö†Ô∏è")

        #Modifier Pseudo

        if choix == 1 :

            print("choix1")

            pseudo_correct = False

            while pseudo_correct == False :

                await author.send("‚ùì Quel est ton pseudo in-game ? ‚ùì")
                try :
                    message_pseudo = await steve.wait_for("message", timeout = 40, check = check_message)

                except :
                    await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
                    return

                pseudo = message_pseudo.content

                if pseudo != "" :
                    pseudo_correct = True
                else :
                    await author.send("‚ö†Ô∏è Ton pseudo est incorrect ! ‚ö†Ô∏è")
            
            #Inscription de la variable dans l'API

            f = open('ldc_api.json', 'r')
            ldc_api = json.load(f)
            f.close()

            ldc_api['joueurs'][joueur_index]['pseudo'] = pseudo
            f = open('ldc_api.json', 'w')
            json.dump(ldc_api, f)
            f.close()

        #Modifier Btag

        if choix == 2 :

            btag_correct = False

            while btag_correct == False :

                await author.send("‚ùì Quel est ton battletag ? ‚ùì")
                try :
                    message_btag = await steve.wait_for("message", timeout = 40, check = check_message)
                
                except :
                    await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
                    return
                
                btag = message_btag.content

                if btag != "" :
                    btag_correct = True
                else :
                    await author.send("‚ö†Ô∏è Ton battletag est incorrect ! ‚ö†Ô∏è")
            
            #Inscription de la variable dans l'API

            f = open('ldc_api.json', 'r')
            ldc_api = json.load(f)
            f.close()

            ldc_api['joueurs'][joueur_index]['btag'] = btag
            f = open('ldc_api.json', 'w')
            json.dump(ldc_api, f)
            f.close()

        #Modifier C√¥tes

        if choix == 3 :

            #Demande de la c√¥te actuelle

            cote_actuelle_correcte = False

            while cote_actuelle_correcte == False :

                await author.send("‚ùì Quel est ta c√¥te actuelle **sur ton r√¥le principal** ? ‚ùì")
                try :
                    message_cote_actuelle = await steve.wait_for("message", timeout = 40, check = check_message)

                except :
                    await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
                    return

                cote_actuelle = int(message_cote_actuelle.content)

                if cote_actuelle >= 1500 and cote_actuelle <= 4700 :
                    cote_actuelle_correcte = True
                else :
                    await author.send("‚ö†Ô∏è Ta c√¥te actuelle est incorrecte ! ‚ö†Ô∏è")

            #Demande du peak de c√¥te

            cote_peak_correcte = False

            while cote_peak_correcte == False :

                await author.send("‚ùì Quel est ton pic de carri√®re **tous r√¥les confondus, toutes saisons confondues, tous comptes confondus** ? ‚ùì")
                try :
                    message_cote_peak = await steve.wait_for("message", timeout = 40, check = check_message)

                except :
                    await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
                    return
                
                cote_peak = int(message_cote_peak.content)

                if cote_peak >= 1500 and cote_peak <= 4700 :
                    if cote_peak >= cote_actuelle :
                        cote_peak_correcte = True
                    else :
                        await author.send("‚ö†Ô∏è Ton pic de carri√®re est inf√©rieur √† ta c√¥te actuelle ! ‚ö†Ô∏è")
                else :
                    await author.send("‚ö†Ô∏è Ton pic de carri√®re est incorrect ! ‚ö†Ô∏è")
            
            #Inscription de la variable dans l'API

            f = open('ldc_api.json', 'r')
            ldc_api = json.load(f)
            f.close()

            ldc_api['joueurs'][joueur_index]['cote_actuelle'] = cote_actuelle
            ldc_api['joueurs'][joueur_index]['cote_peak'] = cote_peak
            ldc_api['joueurs'][joueur_index]['valeur'] = calculerValeur(cote_actuelle, cote_peak)
            f = open('ldc_api.json', 'w')
            json.dump(ldc_api, f)
            f.close()

        #Modifier R√¥le

        if choix == 4 :

            #Demande du r√¥le

            message_roles = await author.send("‚ùì Quel est **ton r√¥le principal** ? *(Tank, Dps, Heal ou Flex)* ‚ùì")
            await message_roles.add_reaction("üõ°Ô∏è")
            await message_roles.add_reaction("‚öîÔ∏è")
            await message_roles.add_reaction("üíä")
            await message_roles.add_reaction("‚ôªÔ∏è")

            def check_reaction(reaction, user) :
                return user == ctx.message.author and message_roles.id == reaction.message.id and (str(reaction.emoji) == "üõ°Ô∏è" or str(reaction.emoji) == "‚öîÔ∏è" or str(reaction.emoji) == "üíä" or str(reaction.emoji) == "‚ôªÔ∏è")

            try :
                reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction)

            except :
                await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
                return

            if reaction.emoji == "üõ°Ô∏è" :
                role = 'Tank'
            elif reaction.emoji == "‚öîÔ∏è" :
                role = 'Dps'
            elif reaction.emoji == "üíä" :
                role = 'Heal'
            elif reaction.emoji == "‚ôªÔ∏è" :
                role = 'Flex'
            
            #Inscription de la variable dans l'API

            f = open('ldc_api.json', 'r')
            ldc_api = json.load(f)
            f.close()

            ldc_api['joueurs'][joueur_index]['role'] = role
            f = open('ldc_api.json', 'w')
            json.dump(ldc_api, f)
            f.close()

        #Modifier Picks

        if choix == 5 :

            #Demande des meilleurs picks

            picks_corrects = 0

            while picks_corrects < 3 :

                await author.send("‚ùì Quels sont tes **3 meilleurs picks** (tous r√¥les confondus) ? ‚ùì")
                await author.send("```\npick1,pick2,pick3\n```")
                try :
                    message_picks = await steve.wait_for("message", timeout = 40, check = check_message)

                except :
                    await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
                    return

                picks = []
                picks.extend(message_picks.content.split(","))

                for pick in picks :
                    if pick != "" :
                        picks_corrects += 1
                    else :
                        await author.send("‚ö†Ô∏è Un de tes picks est incorrect ! ‚ö†Ô∏è")
                        picks_corrects = 0

            #Inscription de la variable dans l'API

            f = open('ldc_api.json', 'r')
            ldc_api = json.load(f)
            f.close()

            print(ldc_api['joueurs'][joueur_index]['picks'])

            i = 0
            while i < 3 :
                ldc_api['joueurs'][joueur_index]['picks'].pop(0)
                i += 1

            print(ldc_api['joueurs'][joueur_index]['picks'])

            for pick in picks :
                ldc_api['joueurs'][joueur_index]['picks'].append(pick)

            print(ldc_api['joueurs'][joueur_index]['picks'])

            f = open('ldc_api.json', 'w')
            json.dump(ldc_api, f)
            f.close()

        #Quitter

        if choix == 6 :
            return
        
        #Update

        f = open('ldc_api.json',)
        ldc_api = json.load(f)
        f.close()
        liste_joueurs = ldc_api['joueurs']
        joueur = liste_joueurs[joueur_index]

        await author.send(f"```\nVos informations personnelles :\n\n1 - Pseudo : {joueur['pseudo']}\n2 - BattleTag : {joueur['btag']}\n3 - C√¥tes : {joueur['cote_peak']} | {joueur['cote_actuelle']}\n4 - R√¥le : {joueur['role']}\n5 - Picks : {joueur['picks'][0]} | {joueur['picks'][1]} | {joueur['picks'][2]}\n6 - Annuler\n```")
        message_confirm = await author.send("‚ùì Les modifications sont-elles correctes ? ‚ùì")

        await message_confirm.add_reaction("‚úîÔ∏è")
        await message_confirm.add_reaction("‚ùå")

        def check_reaction_confirm(reaction, user) :
            return user == ctx.message.author and message_confirm.id == reaction.message.id and (str(reaction.emoji) == "‚úîÔ∏è" or str(reaction.emoji) == "‚ùå")

        try :
            reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction_confirm)

        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return

        if reaction.emoji == "‚úîÔ∏è" :
            await author.send("‚úÖ Vos modifications ont bien √©t√© prises en compte ! ‚úÖ")

            #Inscription de la valeur dans l'API

            f = open('ldc_api.json', 'r')
            ldc_api = json.load(f)
            f.close()

            derniere_modification = datetime.now().strftime('%d/%m/%Y %H:%M')
            ldc_api['joueurs'][joueur_index]['derniere_modification'] = derniere_modification

            f = open('ldc_api.json', 'w')
            json.dump(ldc_api, f)
            f.close()

            modifications_terminees = True

        elif reaction.emoji == "‚ùå" :
            pass

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur')
async def creer_equipe_ligue(ctx, equipe : discord.Role) :
    author = ctx.message.author
    await ctx.message.delete()

    def check_message(message) :
        return message.author == ctx.message.author

    #Verification validation du r√¥le

    role_inscrit = get(ctx.guild.roles, name="Inscrit")
    role_nouveau = get(ctx.guild.roles, name="Nouveau")
    role_moderateur = get(ctx.guild.roles, name="Mod√©rateur")
    role_manager = get(ctx.guild.roles, name="Manager")

    if equipe == role_inscrit or equipe == role_nouveau or equipe == role_moderateur or equipe == role_manager :
        await author.send("‚ö†Ô∏è Ce r√¥le ne peut pas h√©berger une √©quipe ! ‚ö†Ô∏è")
        return

    #Cr√©ation √©quipes

        #Demande du nom

    nom_correct = False

    while nom_correct == False :

        await author.send("‚ùì Quel est le nom de la nouvelle √©quipe de la ligue ? ‚ùì")

        try :
            message_pseudo = await steve.wait_for("message", timeout = 40, check = check_message)

        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return

        nom = message_pseudo.content

        if nom != "" :
            nom_correct = True
        else :
            await author.send("‚ö†Ô∏è Le nom entr√© est incorrect ! ‚ö†Ô∏è")

    date_creation = datetime.now().strftime('%d/%m/%Y %H:%M')

    #V√©rification que l'√©quipe n'existe pas d√©j√†

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    for equipe_ in ldc_api['equipes']['equipes_ligue'] :
        if equipe_['nom'] == nom :
            await author.send("‚ö†Ô∏è Une √©quipe est d√©j√† inscrite sous le m√™me nom ! ‚ö†Ô∏è")

    #Inscription dans l'API

    api_push_equipe_ligue(nom, "", "", equipe.id, 0, 1500000, [], [], date_creation)

    #Validation 

    await author.send(f"‚úÖ L'√©quipe **{nom}** a bien √©t√© inscrite ! ‚úÖ")

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur')
async def supprimer_equipe_ligue(ctx, equipe : discord.Role) :
    author = ctx.message.author
    await ctx.message.delete()

    #V√©rification que l'√©quipe est inscrite

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    equipe_inscrite = False

    for equipe_ligue in ldc_api['equipes']['equipes_ligue'] :

        if equipe_ligue['equipe_id'] == str(equipe.id) :

            equipe_inscrite = True
            equipe_index = ldc_api['equipes']['equipes_ligue'].index(equipe_ligue)
            equipe_nom = equipe_ligue['nom']

    if equipe_inscrite == False :
        await author.send("‚ö†Ô∏è L'√©quipe n'est pas inscrite dans la ligue ! ‚ö†Ô∏è")
        return

    #Suppression des r√¥les des joueurs de l'√©quipe

    role_equipe = ctx.guild.get_role(equipe)

    for joueur in ldc_api['equipes']['equipes_ligue'][equipe_index]['roaster'] :
        if joueur :
            membre = ctx.guild.get_member(joueur.id)
            membre.remove_roles(role_equipe)
        else :
            print('Pas de joueur dans le roaster')

    #Suppression de l'√©quipe

    api_remove_equipe_ligue(equipe.id)

    #Validation

    await author.send(f"‚úÖ L'√©quipe **{equipe_nom}** a bien √©t√© d√©sinscrite ! ‚úÖ")

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur' or 'Manager')
async def signer_contrat(ctx, equipe : discord.Role, joueur : discord.Member) :
    author = ctx.message.author
    await ctx.message.delete()

    def check_message(message) :
        return message.author == ctx.message.author

    #Verification validation du r√¥le

    role_inscrit = get(ctx.guild.roles, name="Inscrit")
    role_nouveau = get(ctx.guild.roles, name="Nouveau")
    role_moderateur = get(ctx.guild.roles, name="Mod√©rateur")
    role_manager = get(ctx.guild.roles, name="Manager")

    if equipe == role_inscrit or equipe == role_nouveau or equipe == role_moderateur or equipe == role_manager :
        await author.send("‚ö†Ô∏è Ce r√¥le n'a pas d'√©quipe ! ‚ö†Ô∏è")
        return

    #V√©rification que le joueur est sur le march√©

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    sur_le_marche = False

    for joueur_ in ldc_api['joueurs'] :
        if joueur_['id'] == str(joueur.id) :
            sur_le_marche = True
            joueur_valeur = joueur_['valeur']

    if sur_le_marche == False : 
        await author.send("‚ö†Ô∏è Ce joueur n'est pas inscrit sur le march√© ! ‚ö†Ô∏è")
        return
    
    print('test 1')

    #V√©rification que le joueur est sur le march√©

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    sur_le_marche = False

    for joueur_ in ldc_api['joueurs'] :
        if joueur_['id'] == str(joueur.id) :
            sur_le_marche = True

    if sur_le_marche == False : 
        await author.send("‚ö†Ô∏è Ce joueur n'est pas inscrit sur le march√© ! ‚ö†Ô∏è")
        return

    #Verification que le manager est de la meme √©quipe

    est_manager = False
    est_moderateur = False

    for role_ in author.roles :
        if role_.name == "Manager" :
            est_manager = True
        if role_.name == "Mod√©rateur" :
            est_moderateur = True

    est_manager_bonne_equipe = False

    if est_manager == True :
        for role_ in author.roles :
            if role_.name == equipe.name :
                est_manager_bonne_equipe = True

    if est_manager_bonne_equipe == False and est_moderateur == False :
        await author.send("‚ö†Ô∏è Vous n'√™tes pas manager de cette √©quipe ! ‚ö†Ô∏è")
        return

    #V√©rification qu'il n'y a pas de contrat en cours

    contrat_en_cours = False
    somme_contrats_en_cours = 0

    for contrat in ldc_api['contrats'] :
        if contrat['equipe_id'] == str(equipe.id) :
            if contrat['joueur_id'] == str(joueur.id) :
                contrat_en_cours = True
                await author.send("‚ö†Ô∏è Tu as d√©j√† un contrat en cours ou en attente avec ce joueur ! ‚ö†Ô∏è")
                return
            for joueur_march√© in ldc_api['joueurs'] :
                if joueur_march√©['equipe_id'] == str(equipe.id) :
                    somme_contrats_en_cours += int(joueur_march√©['valeur'])

    #V√©rification qu'il n'est pas dans une √©quipe

    equipe_trouvee = False

    for equipe_ in ldc_api['equipes']['equipes_ligue'] :
        if equipe_['equipe_id'] == str(equipe.id) :
            equipe_trouvee = True
            equipe_budget = equipe_['budget']
            index_equipe = ldc_api['equipes']['equipes_ligue'].index(equipe_)

    if equipe_trouvee == False :
        await author.send("‚ö†Ô∏è Aucune √©quipe n'a encore √©t√© cr√©√©e pour ce r√¥le ! ‚ö†Ô∏è")
        return

    for joueur_ in ldc_api['equipes']['equipes_ligue'][index_equipe]['roaster'] :
        if joueur_['joueur_id'] == str(joueur.id) :
            await author.send("‚ö†Ô∏è Ce joueur est d√©j√† dans une √©quipe ! ‚ö†Ô∏è")

    #Verification du solde de l'√©quipe

    if int(equipe_budget) - int(joueur_valeur) - somme_contrats_en_cours < 0 :
        await author.send("‚ö†Ô∏è Ce joueur n'entre pas dans votre budget (en comptant aussi vos contrats en attente) ! ‚ö†Ô∏è")
        return

    #Demande du nombre de semaine

    nombre_correct = False

    while nombre_correct == False :

        await author.send(f"‚ùì Combien de **semaines de contrat** proposes-tu √† {joueur.name} ? ‚ùì")

        try :
            message_nombre = await steve.wait_for("message", timeout = 40, check = check_message)

        except :
            await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, l'inscription s'est annul√©e ! ‚åõ")
            return

        nombre = message_nombre.content

        if nombre != "" and int(nombre) > 0 and int(nombre) <= 8 :
            nombre_correct = True
        else :
            await author.send("‚ö†Ô∏è Le nombre de semaines entr√© est incorrect ! ‚ö†Ô∏è")
    

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    contrat_id = 1

    for contrat in ldc_api['contrats'] :
        if contrat :
            contrat_id = int(ldc_api['contrats'][-1]['contrat_id']) + 1

    print(contrat_id)

    api_push_contrat(contrat_id, equipe.id, joueur.id, joueur_valeur, "", nombre, "Proposition envoyee")

    #Validation 

    await author.send(f"üïì Votre proposition de contrat est en attente de r√©ponse ! üïì")

    #Envoi de la proposition au joueur

    message_proposition = await joueur.send(f"‚ùì L'√©quipe {equipe.name} vous propose un contrat de {nombre} semaine(s) avec eux ! ‚ùì")
    await message_proposition.add_reaction("‚ùå")
    await message_proposition.add_reaction("‚úîÔ∏è")

    def check_reaction(reaction, user) :
        return user == joueur and message_proposition.id == reaction.message.id and (str(reaction.emoji) == "‚ùå" or str(reaction.emoji) == "‚úîÔ∏è")

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    for contrat in ldc_api['contrats'] :
        if contrat['equipe_id'] == str(equipe.id) and contrat['joueur_id'] == str(joueur.id) :
            contrat_index = ldc_api['contrats'].index(contrat)

    try :
        reaction, user = await steve.wait_for("reaction_add", timeout = 7200, check = check_reaction)

    except :
        api_remove_contrat(ldc_api['contrats'][contrat_index]['contrat_id'])
        await joueur.send("‚åõ Vous avez mis trop de temps a r√©pondre, le contrat est annul√© ! ‚åõ")
        await author.send(f"‚åõ {joueur.name} n'a pas r√©pondu √† temps, le contrat est annul√© ! ‚åõ")
        return

    if reaction.emoji == "‚ùå" :

        #Retirer le contrat dans l'API

        api_remove_contrat(ldc_api['contrats'][contrat_index]['contrat_id'])
        await joueur.send(f"‚ùå Vous avez bien **refus√© la proposition** de contrat avec {equipe.name} ! ‚ùå")
        await author.send(f"‚ùå {joueur.name} a **refus√© votre proposition** de contrat ! ‚ùå")
        return
        
    elif reaction.emoji == "‚úîÔ∏è" :
        
        #Modifier le contrat dans l'API

        date_debut = datetime.now()
        jour_semaine = datetime.now().strftime('%A')

        if jour_semaine == 'Tuesday' :
            date_debut -= timedelta(days=1)
        elif jour_semaine == 'Wednesday' :
            date_debut -= timedelta(days=2)
        elif jour_semaine == 'Thursday' :
            date_debut -= timedelta(days=3)
        elif jour_semaine == 'Friday' :
            date_debut -= timedelta(days=4)
        elif jour_semaine == 'Saturday' :
            date_debut -= timedelta(days=5)
        elif jour_semaine == 'Sunday' :
            date_debut -= timedelta(days=6)

        f = open('./ldc_api.json', 'r')
        ldc_api = json.load(f)
        f.close()

        ldc_api['contrats'][contrat_index]['date_debut'] = date_debut.strftime('%A %d/%m/%Y')
        ldc_api['contrats'][contrat_index]['etat'] = "En cours"

        f = open('ldc_api.json', 'w')
        json.dump(ldc_api, f)
        f.close()

        joueur_trouve = False

        for joueur_ in ldc_api['joueurs'] :
            if joueur_['id'] == str(joueur.id) :
                joueur_trouve = True
                joueur_index = ldc_api['joueurs'].index(joueur_)
                _joueur = ldc_api['joueurs'][joueur_index]

        if joueur_trouve == False :
            print('ERREUR : Index non-trouv√© !')
            return

        api_push_joueur_into_team(_joueur['pseudo'], _joueur['id'], str(equipe.id), _joueur['valeur'])

        #Asignation des roles et changement de nickname

        await joueur.add_roles(equipe)
        await joueur.remove_roles(role_inscrit)
        if joueur.id != 330789745607049216 :
            await joueur.edit(nick = f'[ {equipe.name} ] {joueur.name}')

        equipe_choisie = ldc_api['equipes']['equipes_ligue'][index_equipe]
        equipe_name = equipe_choisie['nom']
        equipe_logo = equipe_choisie['logo']
        equipe_color = equipe_choisie['color']
       
        await joueur.send(f"‚úÖ Vous avez bien **sign√©** votre contrat avec {equipe.name} ! ‚úÖ")
        await author.send(f"‚úÖ {joueur.name} a **sign√©** votre contrat ! ‚úÖ")

        file = discord.File(f"./Sources/Images/Logos/{equipe_logo}")
        embed = discord.Embed(title = "‚úÖ __***Signature de contrat***__ ‚úÖ", color=int(equipe_color, base = 16))
        embed.set_thumbnail(url = f"attachment://{equipe_logo}")
        embed.add_field(name = f"{joueur.name}", value = f"signe son contrat avec *{equipe_name}* !", inline=False)

        await steve.get_channel(784476911924674584).send(file = file, embed = embed)

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur')
async def annuler_contrat(ctx, joueur : discord.Member) :
    await ctx.message.delete()
    author = ctx.message.author

    #V√©rification qu'il n'y a pas de contrat en cours

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    contrat_en_cours = False

    for contrat_ in ldc_api['contrats'] :
        if contrat_ :
            if contrat_['joueur_id'] == str(joueur.id) :
                contrat_en_cours = True
                contrat_index = ldc_api['contrats'].index(contrat_)
                valeur_contrat = contrat_['valeur']
                contrat_id = contrat_['contrat_id']
                equipe_id = contrat_['equipe_id']

    if contrat_en_cours == False :
        await author.send(f"‚ö†Ô∏è {joueur.name} n'est en contrat avec aucune √©quipe ! ‚ö†Ô∏è")
        return

    equipe = ctx.guild.get_role(int(equipe_id))

    #Annulation du contrat

    api_remove_contrat(str(contrat_id))

    api_remove_joueur_from_team(str(joueur.id), str(equipe_id), valeur_contrat)

    #Suppression des r√¥les et changement de nickname

    role_inscrit = get(joueur.guild.roles, name="Inscrit")

    await joueur.add_roles(role_inscrit)
    await joueur.remove_roles(equipe)
    if joueur.id != 330789745607049216 :
        await joueur.edit(nick = f'{joueur.name}')

    equipe_trouvee = False

    for equipe_ in ldc_api['equipes']['equipes_ligue'] :
        if equipe_['equipe_id'] == str(equipe.id) :
            equipe_trouvee = True
            index_equipe = ldc_api['equipes']['equipes_ligue'].index(equipe_)

    equipe_choisie = ldc_api['equipes']['equipes_ligue'][index_equipe]
    equipe_name = equipe_choisie['nom']
    equipe_logo = equipe_choisie['logo']
    equipe_color = equipe_choisie['color']

    file = discord.File(f"./Sources/Images/Logos/{equipe_logo}")
    embed = discord.Embed(title = "‚ùå __***Rupture de contrat***__ ‚ùå", color=int(equipe_color, base = 16))
    embed.set_thumbnail(url = f"attachment://{equipe_logo}")
    embed.add_field(name = f"{joueur.name}", value = f"ach√®ve contrat avec *{equipe_name}* !", inline=False)

    await joueur.send(f"‚ùå Vous ach√®vez votre contrat avec **{equipe.name}** ‚ùå!")
    
    await steve.get_channel(784476911924674584).send(file = file, embed = embed)

@steve.command()
@commands.check(is_cmd_channel)
async def infos_joueur(ctx, joueur : discord.User) :
    await ctx.message.delete()
    author = ctx.message.author

    #V√©rification qu'il n'y a pas de contrat en cours

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    #Localisation du joueur

    joueur_trouv√© = False

    for joueur_ in ldc_api['joueurs'] :
        if joueur_['id'] == str(joueur.id) :
            joueur_trouv√© = True
            joueur_choisi = ldc_api['joueurs'][ldc_api['joueurs'].index(joueur_)]
            if int(joueur_['equipe_id']) == 0 :
                joueur_color = "0xff7b00"
                joueur_logo = "cup_logo4.png"
            else :
                for equipe_ in ldc_api['equipes']['equipes_ligue'] :
                    if joueur_['equipe_id'] == equipe_['equipe_id'] :
                        joueur_color = equipe_['color']
                        joueur_logo = equipe_['logo']

    if joueur_trouv√© == False :   
        await author.send("‚ö†Ô∏è Le joueur recherch√© n'est pas inscrit ! ‚ö†Ô∏è")
        return

    file = discord.File(f"./Sources/Images/Logos/{joueur_logo}")
    embed = discord.Embed(title = f"__***Infos : {joueur.name}***__", color=int(joueur_color, base = 16))
    embed.set_thumbnail(url = f"attachment://{joueur_logo}")
    
    embed.add_field(name = "Pseudo", value = joueur_choisi['pseudo'], inline = True)
    embed.add_field(name = "DTag", value = joueur_choisi['dtag'], inline = True)
    embed.add_field(name = "Pic de c√¥te", value = joueur_choisi['cote_peak'], inline = True)
    embed.add_field(name = "Valeur", value = joueur_choisi['valeur'] + "$", inline = True)
    embed.add_field(name = "BTag", value = joueur_choisi['btag'], inline = True)
    embed.add_field(name = "C√¥te actuelle", value = joueur_choisi['cote_actuelle'], inline = True)
    embed.add_field(name = "R√¥le", value = joueur_choisi['role'], inline = True)
    embed.add_field(name = "Picks", value = joueur_choisi['picks'][0] + " / " + joueur_choisi['picks'][1] + " / " + joueur_choisi['picks'][2], inline = True)
    embed.add_field(name = "Date d'inscription", value = joueur_choisi['date_inscription'], inline = True)

    await author.send(file = file, embed = embed)

@steve.command()
@commands.check(is_cmd_channel)
async def infos_equipe(ctx, equipe : discord.Role) :
    await ctx.message.delete()
    author = ctx.message.author

    role_manager = get(ctx.guild.roles, name = "Manager")

    #Localisation de l'√©quipe

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    equipe_inscrite = False

    for equipe_ligue in ldc_api['equipes']['equipes_ligue'] :

        if equipe_ligue['equipe_id'] == str(equipe.id) :

            equipe_inscrite = True
            equipe_index = ldc_api['equipes']['equipes_ligue'].index(equipe_ligue)
            equipe_choisie = ldc_api['equipes']['equipes_ligue'][equipe_index]

    if equipe_inscrite == False :
        await author.send("‚ö†Ô∏è L'√©quipe n'est pas inscrite dans la ligue ! ‚ö†Ô∏è")
        return

    #Check if is manager

    is_manager = False

    for role in author.roles :
        if role == role_manager :
            is_manager = True

    #Manager

    if int(equipe_choisie['manager_id']) == 0 :
        manager_nom = "Aucun"
    else :
        for member in ctx.guild.members :
            if member.id == int(equipe_choisie['manager_id']) :
                manager_nom = member.name

    file = discord.File("./Sources/Images/Logos/" + equipe_choisie['logo'])
    embed = discord.Embed(title = "__***Infos : " + equipe_choisie['nom'] + "***__", color=int(equipe_choisie['color'], base = 16))
    embed.set_thumbnail(url = "attachment://" + equipe_choisie['logo'])
    
    embed.add_field(name = "Manager", value = manager_nom, inline = True)
    embed.add_field(name = "Budget actuel", value = equipe_choisie['budget'], inline = True)
    embed.add_field(name = "Score", value = str(equipe_choisie['score']['points']) + " pts (" + str(equipe_choisie['score']['victoires']) + "|" + str(equipe_choisie['score']['egalites']) + "|" + str(equipe_choisie['score']['defaites']) + ")")
    for joueur_roaster in equipe_choisie['roaster'] :
        for joueur_marche in ldc_api['joueurs'] :
            if int(joueur_marche['id']) == int(joueur_roaster['joueur_id']) :
                if is_manager == True :
                    for contrat in ldc_api['contrats'] :
                        if joueur_marche['id'] == contrat['joueur_id'] and equipe_choisie['equipe_id'] == contrat['equipe_id'] :
                            date_debut = datetime.strptime(contrat['date_debut'], '%A %d/%m/%Y')
                            date_fin = date_debut + timedelta(weeks = int(contrat['nombre_de_semaine']))
                    embed.add_field(name = joueur_marche['pseudo'], value = joueur_marche['cote_actuelle'] + " - " + joueur_marche['role'] + "\nFin : " + date_fin.strftime('%d %B'), inline = True)
                else :
                    embed.add_field(name = joueur_marche['pseudo'], value = joueur_marche['cote_actuelle'] + " - " + joueur_marche['role'], inline = True)

    await author.send(file = file, embed = embed)

@steve.command()
@commands.check(is_cmd_channel)
async def infos_march√©(ctx) :
    await ctx.message.delete()
    author = ctx.message.author

    #V√©rification qu'il n'y a pas de contrat en cours

    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    file = discord.File("./Sources/Images/Logos/cup_logo4.png")
    embed = discord.Embed(title = "__***March√©***__", color=0xff7b00)
    embed.set_thumbnail(url = "attachment://cup_logo4.png")

    is_manager = False
    
    for role in author.roles :
        if role.name == "Manager" or role.name == "Mod√©rateur" :
            is_manager = True        

    for joueur in ldc_api['joueurs'] :
        if int(joueur['equipe_id']) == 0 :
            if is_manager == True :
                embed.add_field(name = joueur['pseudo'], value = joueur['cote_peak'] + "/" + joueur['cote_actuelle'] + "\n" + joueur['valeur'] + "$\n" + joueur['dtag'] + "\n**" + joueur['role'] + "**\n*" + joueur['picks'][0] + "/" + joueur['picks'][1] + "/" + joueur['picks'][2] + "*")
            else :
                embed.add_field(name = joueur['pseudo'], value = joueur['cote_peak'] + "/" + joueur['cote_actuelle'] + "\n**" + joueur['role'] + "**\n*" + joueur['picks'][0] + "/" + joueur['picks'][1] + "/" + joueur['picks'][2] + "*")

    await author.send(file = file, embed = embed)

@steve.command()
@commands.has_role('Mod√©rateur')
@commands.check(is_cmd_channel)
async def infos_calendrier(ctx) :
    await ctx.message.delete()
    author = ctx.message.author
    
    f = open('./ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    file = discord.File("./Sources/Images/Logos/cup_logo4.png")
    embed = discord.Embed(title = "__***Calendrier***__", color=0xff7b00)
    embed.set_thumbnail(url = "attachment://cup_logo4.png")

    for week in ldc_api['calendrier'] :
        match_prevus = 0
        for match in week['matchs'] :
            match_prevus += 1
        embed.add_field(name = "__Semaine " + str(week['week']) + " : " + week['type'] + "__", value = week['date_debut'] + "\n" + str(match_prevus) + " matchs pr√©vus")

    await author.send(file = file, embed = embed)

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Manager')
async def prog_match(ctx) :
    await ctx.message.delete()
    author = ctx.message.author

    date_debut = datetime.now()
    jour = datetime.now().strftime('%A')

    f = open('ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    #Check de la semaine

    if jour == 'Tuesday' :
        date_debut -= timedelta(days=1)
    elif jour == 'Wednesday' :
        date_debut -= timedelta(days=2)
    elif jour == 'Thursday' :
        date_debut -= timedelta(days=3)
    elif jour == 'Friday' :
        date_debut -= timedelta(days=4)
    elif jour == 'Saturday' :
        date_debut -= timedelta(days=5)
    elif jour == 'Sunday' :
        date_debut -= timedelta(days=6)

    week_found = False

    for week in ldc_api['calendrier'] :
        if week['date_debut'] == date_debut.strftime('%A %d/%m/%Y') :
            week_found = True
            week_number = week['week']
            week_index = ldc_api['calendrier'].index(week)
    
    if week_found == False :
        return

    #Trouvez l'√©quipe du manager

    role_tokyo = get(ctx.guild.roles, name="Tokyo")
    role_rio = get(ctx.guild.roles, name="Rio")

    for role in author.roles :
        if role == role_rio :
            manager_equipe_id = role_rio.id
        if role == role_tokyo :
            manager_equipe_id = role_tokyo.id

    await author.send("** ‚öΩ PROGRAMMATION MATCH LOCKDOWN CUP ‚öΩ **")

    #Verifier si le match n'est pas programm√©

    for match in ldc_api['calendrier'][week_index]['matchs']['prevus'] :
        if match['id_A'] == str(manager_equipe_id) or match['id_B'] == str(manager_equipe_id) :
            pass
        else :
            return

        if match['etat'] == 'En cours' :
            await author.send("‚ö†Ô∏è Votre match est en cours de la programmation ! ‚ö†Ô∏è")
            return
        elif match['etat'] == 'Programme' :
            await author.send("‚ö†Ô∏è Votre match est d√©j√† programm√© le " + match['date'] + " ! ‚ö†Ô∏è")
            return

    for match in ldc_api['calendrier'][week_index]['matchs']['a_prevoir'] :
        if match['id_A'] == str(manager_equipe_id) :
            for equipe in ldc_api['equipes']['equipes_ligue'] :
                if equipe['equipe_id'] == match['id_B'] :
                    is_equipe_A = True
                    equipe_B_nom = equipe['nom']
                    equipe_adverse = equipe
                if equipe['equipe_id'] == match['id_A'] :
                    equipe_B_nom = equipe['nom']
        elif match['id_B'] == str(manager_equipe_id) :
            for equipe in ldc_api['equipes']['equipes_ligue'] :
                if equipe['equipe_id'] == match['id_A'] :
                    is_equipe_A = False
                    equipe_A_nom = equipe['nom']
                    equipe_adverse = equipe
                if equipe['equipe_id'] == match['id_B'] :
                    equipe_B_nom = equipe['nom']
        else :
            await author.send("‚ö†Ô∏è Vous n'avez aucun match √† programmer cette semaine ! ‚ö†Ô∏è")
            return

    #Demande du jour

    message_jour = await author.send("‚ùì **Quel jour proposez-vous aux " + equipe_adverse['nom'] + "** ‚ùì\n\nüé≤ - Jeudi\nü•® - Vendredi\n‚öì - Samedi\nü§ø - Dimanche")
    await message_jour.add_reaction("üé≤")
    await message_jour.add_reaction("ü•®")
    await message_jour.add_reaction("‚öì")
    await message_jour.add_reaction("ü§ø")

    def check_reaction(reaction, user) :
        return user == ctx.message.author and message_jour.id == reaction.message.id and (str(reaction.emoji) == "ü§ø" or str(reaction.emoji) == "‚öì" or str(reaction.emoji) == "ü•®" or str(reaction.emoji) == "üé≤")

    try :
        reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction)

    except :
        await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
        return

    if reaction.emoji == "üé≤" :
        date_programme = date_debut + timedelta(days=3)
    elif reaction.emoji == "ü•®" :
        date_programme = date_debut + timedelta(days=4)
    elif reaction.emoji == "‚öì" :
        date_programme = date_debut + timedelta(days=5)
    elif reaction.emoji == "ü§ø" :
        date_programme = date_debut + timedelta(days=6)

    #Demande de l'heure

    message_heure = await author.send("‚ùì **Quelle heure proposez-vous aux " + equipe_adverse['nom'] + "** ‚ùì\n\n1Ô∏è‚É£ - 16h/18h\n2Ô∏è‚É£ - 17h/19h\n3Ô∏è‚É£ - 18h/20h\n4Ô∏è‚É£ - 19h/21h\n5Ô∏è‚É£ - 20h/22h\n6Ô∏è‚É£ - 21h/23h")
    await message_heure.add_reaction("1Ô∏è‚É£")
    await message_heure.add_reaction("2Ô∏è‚É£")
    await message_heure.add_reaction("3Ô∏è‚É£")
    await message_heure.add_reaction("4Ô∏è‚É£")
    await message_heure.add_reaction("5Ô∏è‚É£")
    await message_heure.add_reaction("6Ô∏è‚É£")

    def check_reaction_2(reaction, user) :
        return user == ctx.message.author and message_heure.id == reaction.message.id and (str(reaction.emoji) == "6Ô∏è‚É£" or str(reaction.emoji) == "5Ô∏è‚É£" or str(reaction.emoji) == "4Ô∏è‚É£" or str(reaction.emoji) == "3Ô∏è‚É£" or str(reaction.emoji) == "2Ô∏è‚É£" or str(reaction.emoji) == "1Ô∏è‚É£")

    try :
        reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction_2)

    except :
        await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
        return

    if reaction.emoji == "1Ô∏è‚É£" :
        date_programme = datetime.strptime((date_programme.strftime('%A %d/%m/%Y') + " 16:00"), '%A %d/%m/%Y %H:%M')
    elif reaction.emoji == "2Ô∏è‚É£" :
        date_programme = datetime.strptime((date_programme.strftime('%A %d/%m/%Y') + " 17:00"), '%A %d/%m/%Y %H:%M')
    elif reaction.emoji == "3Ô∏è‚É£" :
        date_programme = datetime.strptime((date_programme.strftime('%A %d/%m/%Y') + " 18:00"), '%A %d/%m/%Y %H:%M')
    elif reaction.emoji == "4Ô∏è‚É£" :
        date_programme = datetime.strptime((date_programme.strftime('%A %d/%m/%Y') + " 19:00"), '%A %d/%m/%Y %H:%M')
    elif reaction.emoji == "5Ô∏è‚É£" :
        date_programme = datetime.strptime((date_programme.strftime('%A %d/%m/%Y') + " 20:00"), '%A %d/%m/%Y %H:%M')
    elif reaction.emoji == "6Ô∏è‚É£" :
        date_programme = datetime.strptime((date_programme.strftime('%A %d/%m/%Y') + " 21:00"), '%A %d/%m/%Y %H:%M')

    if len(ldc_api['calendrier'][week_index]['matchs']['prevus']) == 0 :
        match_id = 0
    else :
        match_id = int(ldc_api['calendrier'][week_index]['matchs']['prevus'][-1]['match_id']) + 1

    if is_equipe_A == True :
        ldc_api['calendrier'][week_index]['matchs']['prevus'].append({
            "match_id" : str(match_id),
            "id_A" : str(manager_equipe_id),
            "id_B" : equipe_adverse['equipe_id'],
            "etat" : "En cours",
            "date" : date_programme.strftime("%A %d/%m/%Y %H:%M")
        })
    if is_equipe_A == False :
        ldc_api['calendrier'][week_index]['matchs']['prevus'].append({
            "match_id" : str(match_id),
            "id_A" : equipe_adverse['equipe_id'],
            "id_B" : str(manager_equipe_id),
            "etat" : "En cours",
            "date" : date_programme.strftime("%A %d/%m/%Y %H:%M")
        })

    f = open('ldc_api.json', 'w')
    json.dump(ldc_api, f)
    f.close()

    await author.send(f"üïì Votre proposition d'horaire de match est en attente de r√©ponse ! üïì")

    manager_adverse = get(steve.get_all_members(), id = int(equipe_adverse['manager_id']))

    await manager_adverse.send("** ‚öΩ PROGRAMMATION MATCH LOCKDOWN CUP ‚öΩ **")
    message_adverse = await manager_adverse.send("‚ùì **Les " + equipe_adverse['nom'] + " vous propose un match cette semaine " + date_programme.strftime('%A %d/%m %H:%M') + "** ‚ùì\nCet horaire vous convient-il ?")
    await message_adverse.add_reaction("‚úîÔ∏è")
    await message_adverse.add_reaction("‚ùå")

    def check_reaction_3(reaction, user) :
        return user == manager_adverse and message_adverse.id == reaction.message.id and (str(reaction.emoji) == "‚úîÔ∏è" or str(reaction.emoji) == "‚ùå")

    try :
        reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction_3)

    except :
        await author.send("‚åõ Le manager adverse a mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
        await manager_adverse.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
        return

    if reaction.emoji == "‚ùå" :
        await author.send("‚ùå Le manager adverse a refus√© votre proposition d'horaires, proposez-en une autre ! ‚ùå")
        await manager_adverse.send("‚ùå Vous avez refus√© la proposition d'horaires, proposez-en une autre ! ‚ùå")
        return
    elif reaction.emoji == "‚úîÔ∏è" :
        await author.send("‚úîÔ∏è Votre match est bien programm√© le " + date_programme.strftime('%A %d/%m %H:%M') + " ! ‚úîÔ∏è")
        await manager_adverse.send("‚úîÔ∏è Votre match est bien programm√© le " + date_programme.strftime('%A %d/%m %H:%M') + " ! ‚úîÔ∏è")

        f = open('ldc_api.json', 'r')
        ldc_api = json.load(f)
        f.close()

        for match in ldc_api['calendrier'][week_index]['matchs']['prevus'] :
            if match['match_id'] == str(match_id) :
                index_match = ldc_api['calendrier'][week_index]['matchs']['prevus'].index(match)

        ldc_api['calendrier'][week_index]['matchs']['prevus'][int(index_match)]['etat'] = "Programme"

        f = open('ldc_api.json', 'w')
        json.dump(ldc_api, f)
        f.close()

        file = discord.File(f"./Sources/Images/Logos/cup_logo4.png")
        embed = discord.Embed(title = "‚öΩ __***Annonce de match Semaine " + str(week_number) + "***__ ‚öΩ", color=0xff7b00)
        embed.set_thumbnail(url = f"attachment://cup_logo4.png")
        embed.add_field(name = f"{equipe_A_nom} VS {equipe_B_nom}", value = date_programme.strftime('%A %d/%m %H:%M'), inline=False)

        await steve.get_channel(784476911924674584).send(file = file, embed = embed)


@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur')
async def set_manager(ctx, joueur : discord.Member) :
    await ctx.message.delete()
    author = ctx.message.author

    await author.send("** üíº MANAGER LOCKDOWN CUP üíº **")

    #V√©rification de si le joueur est d√©j√† manager

    role_manager = get(ctx.guild.roles, name="Manager")
    role_nouveau = get(ctx.guild.roles, name="Nouveau")
    role_tokyo = get(ctx.guild.roles, name="Tokyo")
    role_rio = get(ctx.guild.roles, name="Rio")

    for role in joueur.roles :
        if role == role_manager :
            await author.send("‚ö†Ô∏è Le joueur est d√©j√† manager d'une √©quipe ! ‚ö†Ô∏è")
            return

    #Demande de l'√©quipe

    message_equipe = await author.send("‚ùì **De quelle √©quipe " + joueur.name + " devrait-il devenir le manager ?** ‚ùì")
    await message_equipe.add_reaction("ü¶Ö")
    await message_equipe.add_reaction("üíÄ")
    await message_equipe.add_reaction("üêª")
    await message_equipe.add_reaction("ü¶ú")
    await message_equipe.add_reaction("ü¶ò")
    await message_equipe.add_reaction("üå∏")

    def check_reaction(reaction, user) :
        return user == ctx.message.author and message_equipe.id == reaction.message.id and (str(reaction.emoji) == "ü¶Ö" or str(reaction.emoji) == "üíÄ" or str(reaction.emoji) == "üêª" or str(reaction.emoji) == "ü¶ú" or str(reaction.emoji) == "ü¶ò" or str(reaction.emoji) == "üå∏")

    try :
        reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction)

    except :
        await author.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
        return

    guild = get(steve.guilds, id = 784476911924674581)

    if reaction.emoji == "ü¶Ö" :
        print('Athens Wings')
        #equipe_role = get(get(steve.guilds, id = 784476911924674581).roles, name = "Athens")
    elif reaction.emoji == "üíÄ" :
        #equipe_role = get(steve.roles, name = "Athens")
        print('Mexico Inferno')
    elif reaction.emoji == "üêª" :
        #equipe_role = get(steve.roles, name = "Athens")
        print('Moscow Bears')
    elif reaction.emoji == "ü¶ú" :
        equipe_role = get(guild.roles, name = "Rio")
        print('Rio Toucans')
    elif reaction.emoji == "ü¶ò" :
        #equipe_role = get(steve.roles, name = "Athens")
        print('Sydney Punch')
    elif reaction.emoji == "üå∏" :
        equipe_role = get(guild.roles, name = "Tokyo")
        print('Tokyo Bloom')

    #V√©rification si l'√©quipe a d√©j√† un manager

    f = open('ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()
    
    for equipe in ldc_api['equipes']['equipes_ligue'] :
        if equipe['equipe_id'] == str(equipe_role.id) :
            if equipe['manager_id'] != "0" :
                await author.send("‚ö†Ô∏è L'√©quipe poss√®de d√©j√† un manager en fonction ! ‚ö†Ô∏è")
                return

    #V√©rification si le joueur fait parti d'une autre √©quipe

    is_in_another_team = True

    print(equipe_role)

    for role in joueur.roles :
        print(role)
        if role == equipe_role :
            is_in_another_team = False

    if is_in_another_team == True :
        await author.send("‚ö†Ô∏è Le joueur fait parti d'une autre √©quipe ! ‚ö†Ô∏è")
        return
            
    #Envoi de la demande au joueur

    await author.send(f"üïì Votre proposition de promotion est en attente de r√©ponse ! üïì")

    await joueur.send("** üíº MANAGER LOCKDOWN CUP üíº **")
    message_joueur = await joueur.send("‚ùì ** Il vous est propos√© une promotion en tant que manager des " + equipe_role.name + "** ‚ùì\n\nPour rappel, un manager se doit d'√™tre responsable, mature, raisonnable et assidu quant √† sa gestion de ses joueurs.\n**Acceptez-vous cette responsabilit√© ?**")
    await message_joueur.add_reaction("‚úîÔ∏è")
    await message_joueur.add_reaction("‚ùå")

    def check_reaction_2(reaction, user) :
        return user == joueur and message_joueur.id == reaction.message.id and (str(reaction.emoji) == "‚úîÔ∏è" or str(reaction.emoji) == "‚ùå")

    try :
        reaction, user = await steve.wait_for("reaction_add", timeout = 40, check = check_reaction_2)

    except :
        await author.send("‚åõ Le joueur a mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
        await joueur.send("‚åõ Vous avez mis trop de temps a r√©pondre, la proc√©dure s'est annul√©e ! ‚åõ")
        return

    if reaction.emoji == "‚ùå" :
        await author.send("‚ùå Le joueur a refus√© votre proposition de promotion ! ‚ùå")
        await joueur.send("‚ùå Vous avez refus√© la proposition de promotion ! ‚ùå")
        return
    elif reaction.emoji == "‚úîÔ∏è" :
        await author.send("‚úîÔ∏è Le joueur a accept√© la proposition de promotion ! ‚úîÔ∏è")
        await joueur.send("‚úîÔ∏è Vous devenez manager des " + equipe_role.name + " ! ‚úîÔ∏è")

    is_joueur = False

    for role in joueur.roles :
        if role == role_rio or role == role_tokyo :
            is_joueur = True

    f = open('ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()
    
    for equipe in ldc_api['equipes']['equipes_ligue'] :
        if equipe['equipe_id'] == str(equipe_role.id) :
            equipe_ = equipe
            index_equipe = ldc_api['equipes']['equipes_ligue'].index(equipe)

    ldc_api['equipes']['equipes_ligue'][index_equipe]['manager_id'] = str(joueur.id)

    f = open('ldc_api.json', 'w')
    json.dump(ldc_api, f)
    f.close()

    await joueur.add_roles(role_manager)

    if is_joueur == False :
        await joueur.add_roles(equipe_role)
        await joueur.remove_roles(role_nouveau)

    file = discord.File(f"./Sources/Images/Logos/" + equipe_['logo'])
    embed = discord.Embed(title = "üíº __***Promotion de Manager***__ üíº", color=int(equipe_['color'], base = 16))
    embed.set_thumbnail(url = f"attachment://" + equipe_['logo'])
    embed.add_field(name = joueur.name , value = "devient manager des " + equipe_['nom'], inline=False)

    await steve.get_channel(784476911924674584).send(file = file, embed = embed)    

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur')
async def unset_manager(ctx, joueur : discord.Member) :
    await ctx.message.delete()
    author = ctx.message.author

    #V√©rification de si le joueur est d√©j√† manager

    role_manager = get(ctx.guild.roles, name="Manager")
    role_nouveau = get(ctx.guild.roles, name="Nouveau")
    role_tokyo = get(ctx.guild.roles, name="Tokyo")
    role_rio = get(ctx.guild.roles, name="Rio")

    is_manager = False

    for role in joueur.roles :
        if role == role_manager :
            is_manager = True
    
    if is_manager == False :
        await author.send("** üíº MANAGER LOCKDOWN CUP üíº **")
        await author.send("‚ö†Ô∏è Le joueur n'est manager d'aucune √©quipe ! ‚ö†Ô∏è")
        return

    f = open('ldc_api.json', 'r')
    ldc_api = json.load(f)
    f.close()

    for role in joueur.roles :
        if role == role_rio or role == role_tokyo :
            equipe_role = role
    
    for equipe in ldc_api['equipes']['equipes_ligue'] :
        if equipe['equipe_id'] == str(equipe_role.id) :
            equipe_ = equipe
            index_equipe = ldc_api['equipes']['equipes_ligue'].index(equipe)

    ldc_api['equipes']['equipes_ligue'][index_equipe]['manager_id'] = "0"

    f = open('ldc_api.json', 'w')
    json.dump(ldc_api, f)
    f.close()

    await joueur.remove_roles(role_manager)

    for joueur_ in ldc_api['equipes']['equipes_ligue'][index_equipe]['roaster'] :
        if joueur_['joueur_id'] == str(joueur.id) :
            is_joueur = True

    if is_joueur == False :
        await joueur.remove_roles(equipe_role)
        await joueur.add_roles(role_nouveau)

    file = discord.File(f"./Sources/Images/Logos/" + equipe_['logo'])
    embed = discord.Embed(title = "üíº __***Destitution de Manager***__ üíº", color=int(equipe_['color'], base = 16))
    embed.set_thumbnail(url = f"attachment://" + equipe_['logo'])
    embed.add_field(name = joueur.name , value = "n'est plus manager des " + equipe_['nom'], inline=False)

    await steve.get_channel(784476911924674584).send(file = file, embed = embed)

@steve.command()
@commands.check(is_cmd_channel)
async def convocation(ctx, joueur : discord.Member) :
    await ctx.message.delete()
    author = ctx.message.author
    
    if author.voice :
        channel = steve.get_channel(790934994218123286)
        #channel = ctx.author.voice.channel
    else :
        await author.send("‚ö†Ô∏è Tu n'es pas connect√© √† un channel vocal ! ‚ö†Ô∏è")
        return

    if joueur and joueur.voice.channel :
        if joueur.voice.channel != channel :
            await joueur.move_to(channel)
        else :
            await author.send("‚ö†Ô∏è Ce joueur est d√©j√† connect√© au channel vocal ! ‚ö†Ô∏è")
            return

    else :
        await author.send("‚ö†Ô∏è Ce joueur n'est pas encore connect√© √† un channel vocal ! ‚ö†Ô∏è")
        await joueur.send("‚ö†Ô∏è Vous avez √©t√© convoqu√© mais vous n'√™tes connect√© √† aucun channel vocal ! ‚ö†Ô∏è")
        return

@steve.command()
@commands.check(is_cmd_channel)
@commands.has_role('Mod√©rateur')
async def reset_json(ctx) :
    await ctx.message.delete()
    author = ctx.message.author

    #V√©rification qu'il n'y a pas de contrat en cours

    f = open('./ldc_api_vierge.json', 'r')
    ldc_api_new = json.load(f)
    f.close()

    f = open('./ldc_api.json', 'w')
    json.dump(ldc_api_new, f)
    f.close()

    await author.send(f"‚úÖ La base de donn√©es a bien √©t√© r√©initialis√©e ! ‚úÖ")

@steve.command()
async def commandes(ctx) :
    await ctx.message.delete()
    author = ctx.message.author

    file = discord.File("./Sources/Images/Logos/cup_logo4.png")
    embed = discord.Embed(title = "__***Liste des commandes***__", color=0xff7b00)
    embed.set_thumbnail(url = "attachment://cup_logo4.png")
    embed.add_field(name = "Inscription", value = "S'inscrire sur le march√©\n```ldc inscription```", inline=False)
    embed.add_field(name = "Modification de son profil", value = "Modifier ses informations personnelles\n```ldc modification```", inline = False)
    embed.add_field(name = "R√©signation", value = "Se d√©sinscrire de la LockDown Cup\n```ldc resignation @joueur```", inline = False)
    embed.add_field(name = "March√©", value = "Afficher les joueurs actuellement sur le march√©\n```ldc infos_march√©```", inline=False)
    embed.add_field(name = "Infos sur un joueur", value = "Afficher les infos d'un joueur en particulier\n```ldc infos_joueur @joueur```", inline=False)
    embed.add_field(name = "Infos sur une √©quipe", value = "Afficher les infos d'une √©quipe en particulier\n```ldc infos_equipe @equipe```", inline=False)

    for role in author.roles :
        if role.name == "Tokyo" or role.name == "Rio" :
            pass
        if role.name == "Manager" :
            embed.add_field(name = "Proposition d'un contrat", value = "Proposer un contrat √† un joueur dans une √©quipe\n```signer_contrat @equipe @joueur```", inline = False)
        if role.name == "Mod√©rateur" :
            embed.add_field(name = "Nombre de membres", value = "Obtenir le nombre de membres sur le serveur\n```ldc membres```", inline=False)
            embed.add_field(name = "Nettoyer un channel", value = "Nettoyer le channel d'un certain nombre de messages\n```ldc nettoyer [nombre de messages]```", inline=False)
            embed.add_field(name = "Cr√©ation Equipe Ligue", value = "Cr√©er une √©quipe principale de la LDC\n```creer_equipe_ligue @equipe```", inline = False)
            embed.add_field(name = "Suppression Equipe Ligue", value = "Supprimer une √©quipe principale de la LDC\n```supprimer_equipe_ligue @equipe```", inline = False)
            embed.add_field(name = "Proposition d'un contrat", value = "Proposer un contrat √† un joueur dans une √©quipe\n```signer_contrat @equipe @joueur```", inline = False)
            embed.add_field(name = "Annulation d'un contrat", value = "Annuler un contrat d'un joueur en cours\n```annuler_contrat @joueur```", inline = False)
            embed.add_field(name = "Reset du Json", value = "R√©initialise et efface toutes les donn√©es du Json\n```ldc reset_json```", inline=False)

    await author.send(file = file, embed = embed)

steve.run("Nzg0NDcxMDA3MjgwNzU4ODI0.X8pxjg.ZTT-6AQ2-5tYSbLLV7c-TNmkgJU")
